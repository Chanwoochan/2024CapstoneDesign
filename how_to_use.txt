작성: 20191089 김찬우
kcwjoma@kookmin.ac.kr

[매니퓰레이터를 제어하는 방법]

- 터미널 창을 켜고 다음 명령을 입력.

    $ MP

     해당 명령은 ROS2 및 매니퓰레이터와 관련된 인터페이스들을 초기화 합니다.
    매니퓰레이터 사용을 위해 새 터미널을 열고 최초로 꼭 한 번 실행하여야 합니다.


- 다음 명령어로 매니퓰레이터 제어 노드를 실행합니다.

    $ MP_Mrun

     해당 노드는 매니퓰레이터에 있는 각 관절의 모터에 들어 갈 위치제어 신호를 토픽으로 받아, 받은 즉시 모터에 위지제어를 적용합니다.


- 다음 명령어로 Path Mapping 을 진행하는 노드를 실행합니다.

    $ MP_PW

    헤당 노드를 실행하면, 기록하여 저장 할 PATH 파일 이름을 입력하게 됩니다. 컨트롤러의 가변저항 값을 받아와 즉시 PATH파일에 기록함과 동시에, 토픽으로 값을 보냅니다.
    (MP_Mrun 이 실행되고있다면, 모터는 컨트롤러의 모션에 따라 실시간으로 제어됩니다.)

- 다음 명령어로 Path Reading 을 진행하는 노드를 실행합니다.

    $ MP_PR

    해당 노드를 실행하면, 기록하여 저장 한 PATH 파일 이름을 입력하여 해당하는 PATH파일을 불러오게됩니다. 정해진 제어주기로 불러온 값을 토픽으로 보냅니다.
    PATH 파일의 끝으로 가면, 자동으로 파일의 처음으로 돌아가, 모션이 반복됩니다.


[컨트롤러의 데이터를 받아오는 방법]

- 컨트롤러의 가변저항은 ArduinoMEGA의 아날로그 입력핀을 통해 아날로그 신호를 적절한 디지털 신호로 변환합니다.

- PC와 컨트롤러는 UART 통신을 합니다. 컨트롤러가 PC에 데이터를 제공하는 방식은 polling 방식을 사용합니다.


[컨트롤러의 데이터 프로토콜]

- polling 방식을 사용하기 때문에 컨트롤러의 데이터를 제공받기 위해서는 먼저 PC에서 정해진 데이터를 컨트롤러로 전송합니다. 데이터는 다음과 같습니다.

    (1 Byte) -> [0xAB]

- 컨트롤러가 위 데이터를 받으면, 죽시 PC에 데이터를 전송합니다. 데이터는 다음과 같습니다.

    (16 Byte) -> [motor1(2byte)][motor2(2byte)][motor3(2byte)][motor4(2byte)][motor5(2byte)][motor6(2byte)][motor7(2byte)][state(2byte)]

- PC에서 정해진 데이터를 컨트롤러로 전송합니다. 데이터는 다음과 같습니다.

    (1 Byte) -> [0xCD]

- 컨트롤러가 위 데이터를 받으면, 죽시 PC에 데이터를 전송합니다. 데이터는 다음과 같습니다.

    (2 Byte) -> [state(2byte)]

- polling 방식을 사용하며,  최소한의 용량으로 데이터를 저장하기 위해, 시작과 끝 데이터는 정의하지 않았습니다. 또한, 전송에러도 포함하지 않습니다.

